import{r as M,a as d,o as n,b as t,t as o,d as A,f as m,j as u,e as g,g as v,v as p,h as w,F as b,i as y,n as C,u as I,w as x,c as U}from"./vue-kMPmmKrw.js";import"./bootstrap-D5_hyIF7.js";import{_ as S,L as V}from"./LoadingSpinner-CfOyOWer.js";import"./vendor-B9ygI19o.js";const T=window.axios,P={name:"CustomerModal",components:{LoadingSpinner:V},props:{show:{type:Boolean,default:!1},mode:{type:String,default:"add",validator:l=>["add","edit","view"].includes(l)},customer:{type:Object,default:()=>null},errors:{type:Object,default:()=>({})}},data(){return{localForm:{name:"",avatar:null,gender:"",birthday:null,tags:[],notes:"",contacts:[],addresses:[]},avatarPreview:null,avatarFile:null,hadAvatarInitially:!1,availableTags:[],isLoading:!1,t:window.customerTranslations||{}}},watch:{show(l){l?(this.mode==="add"&&this.resetForm(),this.$nextTick(()=>{this.$refs.triggerButton&&this.$refs.triggerButton.click()})):this.$nextTick(()=>{const s=document.getElementById("customerModal");if(s){const i=s.querySelector('button[data-bs-dismiss="modal"]');i&&i.click()}})},customer:{handler(l){this.mode==="edit"&&l&&l.id?(this.isLoading=!0,T.get(`/customers/${l.id}`).then(s=>{const i=s.data;this.populateForm(i)}).catch(s=>{console.error("Error fetching customer details:",s),this.$emit("close"),alert(this.__("error_fetching_data")||"Error loading customer data")}).finally(()=>{this.isLoading=!1})):l?this.populateForm(l):this.resetForm()},immediate:!0,deep:!0},mode(){this.mode==="add"&&this.resetForm()},availableTags(){this.customer&&this.localForm.tags&&this.availableTags.length>0&&this.normalizeTags()}},mounted(){this.$nextTick(()=>{const l=this.$refs.customerModal;l&&l.addEventListener("hidden.bs.modal",()=>{this.$emit("close")})}),this.fetchTags()},methods:{__(l,s=""){return this.t[l]||s||l},populateForm(l){if(this.localForm=JSON.parse(JSON.stringify(l)),this.hadAvatarInitially=!!(l.avatar||l.avatar_url),this.localForm.birthday&&!(typeof this.localForm.birthday=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(this.localForm.birthday))){const s=new Date(this.localForm.birthday);if(isNaN(s.getTime()))this.localForm.birthday=null;else{const i=s.getFullYear(),c=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");this.localForm.birthday=`${i}-${c}-${r}`}}this.localForm.addresses&&this.localForm.addresses.forEach(s=>{const i=s.is_default_shipping;s.is_default_shipping=i===!0||i==="true"||i==1}),this.availableTags&&this.availableTags.length>0&&this.localForm.tags&&this.$nextTick(()=>{this.normalizeTags()})},getFieldError(l){if(!this.errors||!this.errors[l])return null;const s=this.errors[l];return Array.isArray(s)?s[0]:s},handleSave(){const l={...this.localForm,mode:this.mode,avatarFile:this.avatarFile};if(this.mode==="edit"&&this.hadAvatarInitially&&!this.avatarFile&&!this.localForm.avatar&&!this.avatarPreview&&(l.remove_avatar=!0),!(this.localForm.addresses&&this.localForm.addresses.some(i=>i.type==="shipping"||i.is_default_shipping==1))){alert(this.__("shipping_address_required"));return}this.$emit("save",l)},resetForm(){this.localForm={name:"",email:"",phone:"",avatar:null,avatar_url:null,gender:"",birthday:null,tags:[],notes:"",contacts:[],addresses:[]},this.avatarPreview=null,this.avatarFile=null,this.hadAvatarInitially=!1,this.$refs.avatarInput&&(this.$refs.avatarInput.value="")},addContact(){this.localForm.contacts.push({type:"phone",value:"",label:"",tempId:Date.now()+Math.random()})},removeContact(l){this.localForm.contacts.splice(l,1)},addAddress(){this.localForm.addresses.push({type:"home",label:"",address_line:"",building_name:"",apartment_number:"",ward:"",district:"",city:"",lat:null,lng:null,is_default_shipping:0,tempId:Date.now()+Math.random()})},removeAddress(l){this.localForm.addresses.splice(l,1)},handleAddressTypeChange(l){l.type==="shipping"&&(l.is_default_shipping=0)},getGenderLabel(l){return{male:this.__("gender_male"),female:this.__("gender_female"),other:this.__("gender_other")}[l]||this.__("gender_select")},getContactTypeLabel(l){return{phone:this.__("contact_type_phone"),email:this.__("contact_type_email"),zalo:this.__("contact_type_zalo"),facebook:this.__("contact_type_facebook"),telegram:this.__("contact_type_telegram"),whatsapp:this.__("contact_type_whatsapp")}[l]||l},getAddressTypeLabel(l){return{home:this.__("address_type_home"),shipping:this.__("address_type_shipping"),billing:this.__("address_type_billing"),other:this.__("address_type_other")}[l]||l},formatDate(l){if(!l)return"--";const s=new Date(l);if(isNaN(s.getTime()))return"--";const i=String(s.getDate()).padStart(2,"0"),c=String(s.getMonth()+1).padStart(2,"0"),r=s.getFullYear();return(document.documentElement.lang||"vi")==="vi"?`${i}/${c}/${r}`:`${c}/${i}/${r}`},async fetchTags(){try{const l=await T.get("/tags/all");this.availableTags=l.data,this.customer&&this.localForm.tags&&this.normalizeTags()}catch(l){console.error("Error fetching tags:",l)}},normalizeTags(){if(!this.localForm.tags){this.localForm.tags=[];return}if(typeof this.localForm.tags=="string")try{this.localForm.tags=JSON.parse(this.localForm.tags)}catch{this.localForm.tags=[];return}if(!Array.isArray(this.localForm.tags)){this.localForm.tags=[];return}!this.availableTags||this.availableTags.length===0||(this.localForm.tags=this.localForm.tags.map(l=>{if(typeof l=="number"||typeof l=="string"&&/^\d+$/.test(l)){const s=parseInt(l),i=this.availableTags.find(c=>c.id===s);return i?{id:i.id,name:i.name,color:i.color}:null}if(typeof l=="object"&&l!==null){const s=parseInt(l.id||l.tag_id);if(l.id&&l.name&&l.color){const i=this.availableTags.find(c=>c.id===s);return i?{id:i.id,name:i.name,color:i.color}:l}if(s){const i=this.availableTags.find(c=>c.id===s);if(i)return{id:i.id,name:i.name,color:i.color}}return{id:l.id||l.tag_id,name:l.name||"",color:l.color||"#3b82f6"}}return null}).filter(l=>l!==null&&l.id))},isTagSelected(l){return!this.localForm.tags||!Array.isArray(this.localForm.tags)?!1:this.localForm.tags.some(s=>{const i=parseInt(l),c=String(l),r=parseInt(s.id),e=String(s.id);return s.id===l||r===i||e===c})},toggleTag(l){this.localForm.tags||(this.localForm.tags=[]);const s=this.localForm.tags.findIndex(i=>i.id===l.id);s>=0?this.localForm.tags.splice(s,1):this.localForm.tags.push({id:l.id,name:l.name,color:l.color})},getContrastColor(l){if(!l||!l.startsWith("#"))return"#000000";const s=parseInt(l.slice(1,3),16),i=parseInt(l.slice(3,5),16),c=parseInt(l.slice(5,7),16);return(.299*s+.587*i+.114*c)/255>.5?"#000000":"#ffffff"},handleAvatarChange(l){const s=l.target.files[0];if(s){if(!s.type.match("image.*")){alert(this.__("avatar_invalid_type"));return}if(s.size>2*1024*1024){alert(this.__("avatar_too_large"));return}this.avatarFile=s;const i=new FileReader;i.onload=c=>{this.avatarPreview=c.target.result},i.readAsDataURL(s)}},removeAvatar(){this.avatarPreview=null,this.avatarFile=null,this.localForm.avatar=null,this.$refs.avatarInput&&(this.$refs.avatarInput.value="")}}},L={ref:"triggerButton",type:"button",class:"d-none","data-bs-toggle":"modal","data-bs-target":"#customerModal"},D={class:"modal modal-blur fade",tabindex:"-1",role:"dialog",ref:"customerModal",id:"customerModal","data-bs-backdrop":"static","data-bs-keyboard":"false"},N={class:"modal-dialog modal-lg",role:"document"},j={class:"modal-content"},B={class:"modal-header"},O={class:"modal-title"},z={class:"modal-body position-relative"},J={key:0,id:"customer-form",enctype:"multipart/form-data"},q={class:"mb-3"},G={class:"form-label"},H={class:"d-flex align-items-center gap-3"},R={key:0,class:"avatar-preview"},W=["src"],Y={class:"flex-fill"},Q={key:0,class:"invalid-feedback"},X={class:"text-secondary"},Z={class:"row g-2 mb-3"},K={class:"col-md-6"},$={class:"form-label"},ee={key:0,class:"invalid-feedback"},te={class:"col-md-6"},se={class:"form-label"},le={value:""},ae={value:"male"},re={value:"female"},oe={value:"other"},de={key:0,class:"invalid-feedback"},ne={class:"row g-2 mb-3"},ie={class:"col-md-6"},ce={class:"form-label"},_e=["placeholder"],he={key:0,class:"invalid-feedback"},me={class:"col-md-6"},ue={class:"form-label"},ge=["placeholder"],ve={key:0,class:"invalid-feedback"},fe={class:"row g-2 mb-3"},pe={class:"col-md-6"},be={class:"form-label"},ye=["max"],Fe={key:0,class:"invalid-feedback"},ke={class:"col-md-6"},we={class:"form-label"},Ee={class:"d-flex flex-wrap gap-2"},xe=["value","checked","onChange"],Ce={key:0,class:"text-secondary"},Te={target:"_blank",href:"/tags/manage"},Me={class:"mb-3"},Ae={class:"form-label"},Se={key:0,class:"invalid-feedback"},Ie={class:"mb-4"},Ue={class:"font-semibold mb-2"},Ve={class:"flex-fill"},Pe=["onUpdate:modelValue"],Le={value:"phone"},De={value:"email"},Ne={value:"zalo"},je={value:"facebook"},Be={value:"telegram"},Oe={value:"whatsapp"},ze={key:0,class:"invalid-feedback"},Je={class:"flex-fill"},qe=["onUpdate:modelValue","placeholder"],Ge={key:0,class:"invalid-feedback"},He={class:"flex-fill"},Re=["onUpdate:modelValue","placeholder"],We={key:0,class:"invalid-feedback"},Ye=["onClick"],Qe={class:"mb-4"},Xe={class:"font-semibold mb-2"},Ze={class:"d-flex gap-2 mb-2"},Ke={class:"flex-fill"},$e=["onUpdate:modelValue","onChange"],et={value:"home"},tt={value:"shipping"},st={value:"billing"},lt={value:"other"},at={key:0,class:"invalid-feedback"},rt={class:"flex-fill"},ot=["onUpdate:modelValue","placeholder"],dt={key:0,class:"invalid-feedback"},nt=["onClick"],it={class:"row g-2"},ct={class:"col-12 col-md-6"},_t=["onUpdate:modelValue","placeholder"],ht={key:0,class:"invalid-feedback"},mt={class:"col-12 col-md-6"},ut=["onUpdate:modelValue","placeholder"],gt={key:0,class:"invalid-feedback"},vt={class:"col-12 col-md-6"},ft=["onUpdate:modelValue","placeholder"],pt={key:0,class:"invalid-feedback"},bt={class:"col-12 col-md-6"},yt=["onUpdate:modelValue","placeholder"],Ft={key:0,class:"invalid-feedback"},kt={class:"col-12 col-md-6"},wt=["onUpdate:modelValue","placeholder"],Et={key:0,class:"invalid-feedback"},xt={class:"col-12 col-md-6"},Ct=["onUpdate:modelValue","placeholder"],Tt={key:0,class:"invalid-feedback"},Mt={key:0,class:"mt-2 d-flex gap-3"},At={class:"form-check"},St=["onUpdate:modelValue"],It={class:"form-check-label"},Ut={key:1},Vt={key:0,class:"mb-4"},Pt={class:"mt-2"},Lt=["src"],Dt={class:"mb-4"},Nt={class:"mb-4"},jt={key:1,class:"mb-4"},Bt={key:2,class:"mb-4"},Ot={class:"d-flex flex-wrap gap-2 mt-2"},zt={key:3,class:"mb-4"},Jt={class:"mb-4"},qt={key:0},Gt={key:0},Ht={class:"mb-4"},Rt={key:0},Wt={class:"modal-footer"},Yt={type:"button",class:"btn","data-bs-dismiss":"modal"},Qt={key:1,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"};function Xt(l,s,i,c,r,e){const f=M("LoadingSpinner");return n(),d("div",null,[t("button",L,null,512),t("div",D,[t("div",N,[t("div",j,[t("div",B,[t("h5",O,o(i.mode==="add"?e.__("add_customer"):i.mode==="edit"?e.__("edit_customer"):e.__("customer_details")),1),s[11]||(s[11]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",z,[A(f,{visible:r.isLoading},null,8,["visible"]),i.mode!=="view"?(n(),d("form",J,[t("div",q,[t("label",G,o(e.__("avatar")),1),t("div",H,[r.avatarPreview||r.localForm.avatar_url||r.localForm.avatar?(n(),d("div",R,[t("img",{src:r.avatarPreview||r.localForm.avatar_url,alt:"Avatar",class:"rounded",style:{width:"80px",height:"80px","object-fit":"cover",border:"1px solid #ddd"}},null,8,W)])):m("",!0),t("div",Y,[t("input",{type:"file",ref:"avatarInput",onChange:s[0]||(s[0]=(...a)=>e.handleAvatarChange&&e.handleAvatarChange(...a)),accept:"image/jpeg,image/png,image/jpg,image/gif",class:u(["form-control",{"is-invalid":e.getFieldError("avatar")}])},null,34),e.getFieldError("avatar")?(n(),d("div",Q,o(e.getFieldError("avatar")),1)):m("",!0),t("small",X,o(e.__("avatar_hint")),1)]),r.avatarPreview||r.localForm.avatar_url||r.localForm.avatar?(n(),d("button",{key:1,type:"button",onClick:s[1]||(s[1]=(...a)=>e.removeAvatar&&e.removeAvatar(...a)),class:"btn btn-sm btn-danger"},o(e.__("remove")),1)):m("",!0)])]),t("div",Z,[t("div",K,[t("label",$,[v(o(e.__("name"))+" ",1),s[12]||(s[12]=t("span",{class:"text-danger"},"*",-1))]),g(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>r.localForm.name=a),required:"",class:u(["form-control",{"is-invalid":e.getFieldError("name")}])},null,2),[[p,r.localForm.name]]),e.getFieldError("name")?(n(),d("div",ee,o(e.getFieldError("name")),1)):m("",!0)]),t("div",te,[t("label",se,o(e.__("gender")),1),g(t("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>r.localForm.gender=a),class:u(["form-select",{"is-invalid":e.getFieldError("gender")}])},[t("option",le,o(e.__("gender_select")),1),t("option",ae,o(e.__("gender_male")),1),t("option",re,o(e.__("gender_female")),1),t("option",oe,o(e.__("gender_other")),1)],2),[[w,r.localForm.gender]]),e.getFieldError("gender")?(n(),d("div",de,o(e.getFieldError("gender")),1)):m("",!0)])]),t("div",ne,[t("div",ie,[t("label",ce,o(e.__("contact_type_phone")),1),g(t("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>r.localForm.phone=a),type:"tel",class:u(["form-control",{"is-invalid":e.getFieldError("phone")}]),placeholder:e.__("contact_type_phone")},null,10,_e),[[p,r.localForm.phone]]),e.getFieldError("phone")?(n(),d("div",he,o(e.getFieldError("phone")),1)):m("",!0)]),t("div",me,[t("label",ue,o(e.__("contact_type_email")),1),g(t("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>r.localForm.email=a),type:"email",class:u(["form-control",{"is-invalid":e.getFieldError("email")}]),placeholder:e.__("contact_type_email")},null,10,ge),[[p,r.localForm.email]]),e.getFieldError("email")?(n(),d("div",ve,o(e.getFieldError("email")),1)):m("",!0)])]),t("div",fe,[t("div",pe,[t("label",be,o(e.__("birthday")),1),g(t("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>r.localForm.birthday=a),type:"date",class:u(["form-control",{"is-invalid":e.getFieldError("birthday")}]),max:new Date().toISOString().split("T")[0]},null,10,ye),[[p,r.localForm.birthday]]),e.getFieldError("birthday")?(n(),d("div",Fe,o(e.getFieldError("birthday")),1)):m("",!0)]),t("div",ke,[t("label",we,o(e.__("tags")),1),t("div",Ee,[(n(!0),d(b,null,y(r.availableTags,a=>(n(),d("label",{key:a.id,class:"form-check form-check-inline"},[t("input",{type:"checkbox",class:"form-check-input",value:a.id,checked:e.isTagSelected(a.id),onChange:h=>e.toggleTag(a)},null,40,xe),t("span",{class:"form-check-label badge",style:C({backgroundColor:a.color,color:e.getContrastColor(a.color)})},o(a.name),5)]))),128)),!r.availableTags||r.availableTags.length===0?(n(),d("div",Ce,[t("small",null,o(e.__("no_tags_available")),1),t("a",Te,o(e.__("create_tag")),1)])):m("",!0)])])]),t("div",Me,[t("label",Ae,o(e.__("notes")),1),g(t("textarea",{"onUpdate:modelValue":s[7]||(s[7]=a=>r.localForm.notes=a),class:u(["form-control",{"is-invalid":e.getFieldError("notes")}])},null,2),[[p,r.localForm.notes]]),e.getFieldError("notes")?(n(),d("div",Se,o(e.getFieldError("notes")),1)):m("",!0)]),t("div",Ie,[t("h4",Ue,o(e.__("contacts"))+" ("+o(e.__("other_contacts"))+")",1),(n(!0),d(b,null,y(r.localForm.contacts,(a,h)=>(n(),d("div",{key:h,class:"d-flex gap-2 mb-2"},[t("div",Ve,[g(t("select",{"onUpdate:modelValue":_=>a.type=_,class:u(["form-select",{"is-invalid":e.getFieldError(`contacts.${h}.type`)}])},[t("option",Le,o(e.__("contact_type_phone")),1),t("option",De,o(e.__("contact_type_email")),1),t("option",Ne,o(e.__("contact_type_zalo")),1),t("option",je,o(e.__("contact_type_facebook")),1),t("option",Be,o(e.__("contact_type_telegram")),1),t("option",Oe,o(e.__("contact_type_whatsapp")),1)],10,Pe),[[w,a.type]]),e.getFieldError(`contacts.${h}.type`)?(n(),d("div",ze,o(e.getFieldError(`contacts.${h}.type`)),1)):m("",!0)]),t("div",Je,[g(t("input",{"onUpdate:modelValue":_=>a.value=_,placeholder:e.__("value"),class:u(["form-control",{"is-invalid":e.getFieldError(`contacts.${h}.value`)}])},null,10,qe),[[p,a.value]]),e.getFieldError(`contacts.${h}.value`)?(n(),d("div",Ge,o(e.getFieldError(`contacts.${h}.value`)),1)):m("",!0)]),t("div",He,[g(t("input",{"onUpdate:modelValue":_=>a.label=_,placeholder:e.__("label"),class:u(["form-control",{"is-invalid":e.getFieldError(`contacts.${h}.label`)}])},null,10,Re),[[p,a.label]]),e.getFieldError(`contacts.${h}.label`)?(n(),d("div",We,o(e.getFieldError(`contacts.${h}.label`)),1)):m("",!0)]),t("button",{type:"button",onClick:_=>e.removeContact(h),class:"btn btn-danger"},"-",8,Ye)]))),128)),t("button",{type:"button",onClick:s[8]||(s[8]=(...a)=>e.addContact&&e.addContact(...a)),class:"btn btn-success"},o(e.__("add_contact")),1)]),t("div",Qe,[t("h4",Xe,o(e.__("addresses")),1),(n(!0),d(b,null,y(r.localForm.addresses,(a,h)=>(n(),d("div",{key:h,class:"mb-3 border p-3 rounded"},[t("div",Ze,[t("div",Ke,[g(t("select",{"onUpdate:modelValue":_=>a.type=_,onChange:_=>e.handleAddressTypeChange(a),class:u(["form-select",{"is-invalid":e.getFieldError(`addresses.${h}.type`)}])},[t("option",et,o(e.__("address_type_home")),1),t("option",tt,o(e.__("address_type_shipping")),1),t("option",st,o(e.__("address_type_billing")),1),t("option",lt,o(e.__("address_type_other")),1)],42,$e),[[w,a.type]]),e.getFieldError(`addresses.${h}.type`)?(n(),d("div",at,o(e.getFieldError(`addresses.${h}.type`)),1)):m("",!0)]),t("div",rt,[g(t("input",{"onUpdate:modelValue":_=>a.label=_,placeholder:e.__("label"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.label`)}])},null,10,ot),[[p,a.label]]),e.getFieldError(`addresses.${h}.label`)?(n(),d("div",dt,o(e.getFieldError(`addresses.${h}.label`)),1)):m("",!0)]),t("button",{type:"button",onClick:_=>e.removeAddress(h),class:"btn btn-danger"},"-",8,nt)]),t("div",it,[t("div",ct,[g(t("input",{"onUpdate:modelValue":_=>a.address_line=_,placeholder:e.__("address_line"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.address_line`)}])},null,10,_t),[[p,a.address_line]]),e.getFieldError(`addresses.${h}.address_line`)?(n(),d("div",ht,o(e.getFieldError(`addresses.${h}.address_line`)),1)):m("",!0)]),t("div",mt,[g(t("input",{"onUpdate:modelValue":_=>a.building_name=_,placeholder:e.__("building_name"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.building_name`)}])},null,10,ut),[[p,a.building_name]]),e.getFieldError(`addresses.${h}.building_name`)?(n(),d("div",gt,o(e.getFieldError(`addresses.${h}.building_name`)),1)):m("",!0)]),t("div",vt,[g(t("input",{"onUpdate:modelValue":_=>a.apartment_number=_,placeholder:e.__("apartment_number"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.apartment_number`)}])},null,10,ft),[[p,a.apartment_number]]),e.getFieldError(`addresses.${h}.apartment_number`)?(n(),d("div",pt,o(e.getFieldError(`addresses.${h}.apartment_number`)),1)):m("",!0)]),t("div",bt,[g(t("input",{"onUpdate:modelValue":_=>a.ward=_,placeholder:e.__("ward"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.ward`)}])},null,10,yt),[[p,a.ward]]),e.getFieldError(`addresses.${h}.ward`)?(n(),d("div",Ft,o(e.getFieldError(`addresses.${h}.ward`)),1)):m("",!0)]),t("div",kt,[g(t("input",{"onUpdate:modelValue":_=>a.district=_,placeholder:e.__("district"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.district`)}])},null,10,wt),[[p,a.district]]),e.getFieldError(`addresses.${h}.district`)?(n(),d("div",Et,o(e.getFieldError(`addresses.${h}.district`)),1)):m("",!0)]),t("div",xt,[g(t("input",{"onUpdate:modelValue":_=>a.city=_,placeholder:e.__("city"),class:u(["form-control",{"is-invalid":e.getFieldError(`addresses.${h}.city`)}])},null,10,Ct),[[p,a.city]]),e.getFieldError(`addresses.${h}.city`)?(n(),d("div",Tt,o(e.getFieldError(`addresses.${h}.city`)),1)):m("",!0)])]),a.type!=="shipping"?(n(),d("div",Mt,[t("label",At,[g(t("input",{type:"checkbox","onUpdate:modelValue":_=>a.is_default_shipping=_,class:"form-check-input"},null,8,St),[[I,a.is_default_shipping]]),t("span",It,o(e.__("is_default_shipping")),1)])])):m("",!0)]))),128)),t("button",{type:"button",onClick:s[9]||(s[9]=(...a)=>e.addAddress&&e.addAddress(...a)),class:"btn btn-success"},o(e.__("add_address")),1)])])):(n(),d("div",Ut,[r.localForm.avatar?(n(),d("div",Vt,[t("strong",null,o(e.__("avatar"))+":",1),t("div",Pt,[t("img",{src:r.localForm.avatar_url,alt:"Avatar",class:"rounded",style:{width:"120px",height:"120px","object-fit":"cover",border:"1px solid #ddd"}},null,8,Lt)])])):m("",!0),t("div",Dt,[t("strong",null,o(e.__("name"))+":",1),v(" "+o(r.localForm.name),1)]),t("div",Nt,[t("strong",null,o(e.__("gender"))+":",1),v(" "+o(e.getGenderLabel(r.localForm.gender)),1)]),r.localForm.birthday?(n(),d("div",jt,[t("strong",null,o(e.__("birthday"))+":",1),v(" "+o(e.formatDate(r.localForm.birthday)),1)])):m("",!0),r.localForm.tags&&r.localForm.tags.length>0?(n(),d("div",Bt,[t("strong",null,o(e.__("tags"))+":",1),t("div",Ot,[(n(!0),d(b,null,y(r.localForm.tags,a=>(n(),d("span",{key:a.id,class:"badge",style:C({backgroundColor:a.color,color:e.getContrastColor(a.color)})},o(a.name),5))),128))])])):m("",!0),r.localForm.notes?(n(),d("div",zt,[t("strong",null,o(e.__("notes"))+":",1),v(" "+o(r.localForm.notes),1)])):m("",!0),t("div",Jt,[t("strong",null,o(e.__("contacts"))+":",1),(n(!0),d(b,null,y(r.localForm.contacts,a=>(n(),d("div",{key:a.id||a.tempId},[v(o(e.getContactTypeLabel(a.type))+" - "+o(a.value)+" ",1),a.label?(n(),d("span",qt,"("+o(a.label)+")",1)):m("",!0)]))),128)),!r.localForm.contacts||r.localForm.contacts.length===0?(n(),d("div",Gt,o(e.__("no_contacts")),1)):m("",!0)]),t("div",Ht,[t("strong",null,o(e.__("addresses"))+":",1),(n(!0),d(b,null,y(r.localForm.addresses,a=>(n(),d("div",{key:a.id||a.tempId},o(a.label||e.getAddressTypeLabel(a.type))+" - "+o(a.address_line)+" "+o(a.city),1))),128)),!r.localForm.addresses||r.localForm.addresses.length===0?(n(),d("div",Rt,o(e.__("no_addresses")),1)):m("",!0)])]))]),t("div",Wt,[t("button",Yt,o(e.__("cancel")),1),i.mode!=="view"?(n(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:s[10]||(s[10]=(...a)=>e.handleSave&&e.handleSave(...a))},[s[13]||(s[13]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon icon-1"},[t("path",{d:"M5 12l5 5l10 -10"})],-1)),v(" "+o(e.__("save")),1)])):(n(),d("button",Qt,o(e.__("close")),1))])])])],512)])}const Zt=S(P,[["render",Xt],["__scopeId","data-v-3d0bcc9a"]]),k=window.axios,Kt={components:{CustomerModal:Zt},data(){return{customers:{data:[],current_page:1,per_page:10,last_page:1,total:0,next_page_url:null,prev_page_url:null},search:"",perPage:10,perPageOptions:[10,20,50,100],showModal:!1,modalMode:"add",selectedCustomer:null,validationErrors:{},t:window.customerTranslations||{}}},mounted(){this.fetchCustomers(),this.$nextTick(()=>{const l=document.getElementById("btn-add-customer"),s=document.getElementById("btn-add-customer-mobile");l&&l.addEventListener("click",()=>this.openAdd()),s&&s.addEventListener("click",()=>this.openAdd())})},methods:{__(l,s=""){return this.t[l]||s||l},fetchCustomers(l=1){const s={search:this.search,per_page:this.perPage,page:l};k.get("/customers",{params:s}).then(i=>{this.customers=i.data}).catch(i=>{console.error(i)})},prevPage(){this.customers.prev_page_url&&this.fetchCustomers(this.customers.current_page-1)},nextPage(){this.customers.next_page_url&&this.fetchCustomers(this.customers.current_page+1)},openAdd(){this.modalMode="add",this.selectedCustomer=null,this.validationErrors={},this.showModal=!0},openEdit(l){this.modalMode="edit",this.selectedCustomer=JSON.parse(JSON.stringify(l)),this.validationErrors={},this.showModal=!0},openView(l){this.modalMode="view",this.selectedCustomer=JSON.parse(JSON.stringify(l)),this.validationErrors={},this.showModal=!0},handleModalClose(){this.showModal=!1,this.selectedCustomer=null,this.validationErrors={}},handleModalSave(l){const s=new FormData;Object.keys(l).forEach(c=>{c==="avatarFile"?l.avatarFile&&s.append("avatar",l.avatarFile):c==="avatar"||(c==="remove_avatar"?l.remove_avatar&&s.append("remove_avatar","1"):c==="mode"||(c==="tags"?Array.isArray(l[c])?l[c].length===0?s.append("tags_clear","1"):l[c].forEach((r,e)=>{s.append(`tags[${e}][id]`,r.id),s.append(`tags[${e}][name]`,r.name),s.append(`tags[${e}][color]`,r.color)}):s.append("tags_clear","1"):c==="contacts"&&Array.isArray(l[c])?l[c].forEach((r,e)=>{Object.keys(r).forEach(f=>{s.append(`contacts[${e}][${f}]`,r[f]||"")})}):c==="addresses"&&Array.isArray(l[c])?l[c].forEach((r,e)=>{Object.keys(r).forEach(f=>{const a=r[f];a!=null&&s.append(`addresses[${e}][${f}]`,a)})}):l[c]!==null&&l[c]!==void 0&&s.append(c,l[c])))}),this.validationErrors={};const i={headers:{"Content-Type":"multipart/form-data"}};l.mode==="add"?k.post("/customers",s,i).then(c=>{this.fetchCustomers(),this.closeModal()}).catch(c=>{var r,e,f,a,h,_,F;if(console.error(c),((r=c.response)==null?void 0:r.status)===422&&((f=(e=c.response)==null?void 0:e.data)!=null&&f.errors))this.validationErrors=c.response.data.errors;else{const E=((h=(a=c.response)==null?void 0:a.data)==null?void 0:h.message)||((F=(_=c.response)==null?void 0:_.data)==null?void 0:F.error)||c.message;alert(this.__("save_error")+": "+E)}}):(s.append("_method","PUT"),k.post(`/customers/${l.id}`,s,i).then(c=>{this.fetchCustomers(),this.closeModal()}).catch(c=>{var r,e,f,a,h,_,F;if(console.error(c),((r=c.response)==null?void 0:r.status)===422&&((f=(e=c.response)==null?void 0:e.data)!=null&&f.errors))this.validationErrors=c.response.data.errors;else{const E=((h=(a=c.response)==null?void 0:a.data)==null?void 0:h.message)||((F=(_=c.response)==null?void 0:_.data)==null?void 0:F.error)||c.message;alert(this.__("update_error")+": "+E)}}))},closeModal(){this.showModal=!1,this.selectedCustomer=null,this.validationErrors={},this.$nextTick(()=>{const l=document.getElementById("customerModal");if(l){const s=l.querySelector('button[data-bs-dismiss="modal"]');s?s.click():this.handleModalClose()}else this.handleModalClose()})},confirmDelete(l){confirm(this.__("delete_confirm"))&&k.delete(`/customers/${l.id}`).then(()=>{this.fetchCustomers()}).catch(s=>{console.error(s),alert(this.__("delete_error"))})},getContrastColor(l){if(!l||!l.startsWith("#"))return"#000000";const s=parseInt(l.slice(1,3),16),i=parseInt(l.slice(3,5),16),c=parseInt(l.slice(5,7),16);return(.299*s+.587*i+.114*c)/255>.5?"#000000":"#ffffff"},getPageNumbers(){const l=this.customers.current_page||1,s=this.customers.last_page||1,i=[],c=5;if(s<=c)for(let r=1;r<=s;r++)i.push(r);else if(l<=3)for(let r=1;r<=c;r++)i.push(r);else if(l>=s-2)for(let r=s-c+1;r<=s;r++)i.push(r);else for(let r=l-2;r<=l+2;r++)i.push(r);return i}}},$t={class:"card-body border-bottom py-3"},es={class:"d-flex"},ts={class:"text-secondary"},ss={class:"mx-2 d-inline-block"},ls=["value"],as={class:"ms-auto text-secondary"},rs={class:"ms-2 d-inline-block"},os=["placeholder"],ds={class:"table-responsive"},ns={class:"table card-table table-vcenter text-nowrap datatable"},is={class:"w-1"},cs={class:"text-secondary"},_s={class:"d-flex align-items-center gap-2"},hs=["src"],ms={href:"#",class:"text-reset"},us={key:0,class:"d-flex flex-wrap gap-1"},gs={key:1,class:"text-secondary"},vs={key:0,class:"text-secondary"},fs={key:0,class:"text-secondary"},ps={class:"text-end"},bs={class:"btn-list justify-content-end"},ys=["onClick"],Fs=["onClick"],ks=["onClick"],ws={key:0},Es={colspan:"6",class:"text-center text-secondary py-4"},xs={class:"card-footer d-flex align-items-center"},Cs={class:"m-0 text-secondary"},Ts={class:"pagination m-0 ms-auto"},Ms=["tabindex","aria-disabled"],As=["onClick"],Ss=["tabindex","aria-disabled"];function Is(l,s,i,c,r,e){const f=M("CustomerModal");return n(),d("div",null,[t("div",$t,[t("div",es,[t("div",ts,[v(o(e.__("show"))+" ",1),t("div",ss,[g(t("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>r.perPage=a),onChange:s[1]||(s[1]=(...a)=>e.fetchCustomers&&e.fetchCustomers(...a)),class:"form-select form-select-sm"},[(n(!0),d(b,null,y(r.perPageOptions,a=>(n(),d("option",{key:a,value:a},o(a),9,ls))),128))],544),[[w,r.perPage,void 0,{number:!0}]])]),v(" "+o(e.__("entries")),1)]),t("div",as,[v(o(e.__("search"))+": ",1),t("div",rs,[g(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>r.search=a),onInput:s[3]||(s[3]=(...a)=>e.fetchCustomers&&e.fetchCustomers(...a)),type:"text",class:"form-control form-control-sm",placeholder:e.__("search_placeholder")},null,40,os),[[p,r.search]])])])])]),t("div",ds,[t("table",ns,[t("thead",null,[t("tr",null,[t("th",is,o(e.__("no")),1),t("th",null,o(e.__("name")),1),t("th",null,o(e.__("phone")),1),t("th",null,o(e.__("tags")),1),t("th",null,o(e.__("contact")),1),t("th",null,o(e.__("address")),1),s[6]||(s[6]=t("th",null,null,-1))])]),t("tbody",null,[(n(!0),d(b,null,y(r.customers.data,(a,h)=>(n(),d("tr",{key:a.id},[t("td",null,[t("span",cs,o((r.customers.current_page-1)*r.customers.per_page+h+1),1)]),t("td",null,[t("div",_s,[a.avatar?(n(),d("img",{key:0,src:a.avatar_url,alt:"Avatar",class:"rounded",style:{width:"32px",height:"32px","object-fit":"cover"}},null,8,hs)):m("",!0),t("a",ms,o(a.name),1)])]),t("td",null,o(a.phone),1),t("td",null,[a.tags&&a.tags.length>0?(n(),d("div",us,[(n(!0),d(b,null,y(a.tags,_=>(n(),d("span",{key:_.id,class:"badge",style:C({backgroundColor:_.color,color:e.getContrastColor(_.color)})},o(_.name),5))),128))])):(n(),d("div",gs,[...s[7]||(s[7]=[t("small",null,"--",-1)])]))]),t("td",null,[(n(!0),d(b,null,y(a.contacts,_=>(n(),d("div",{key:_.id,class:"text-secondary"},[t("small",null,o(_.type)+": "+o(_.value),1)]))),128)),!a.contacts||a.contacts.length===0?(n(),d("div",vs,[...s[8]||(s[8]=[t("small",null,"--",-1)])])):m("",!0)]),t("td",null,[(n(!0),d(b,null,y(a.addresses,_=>(n(),d("div",{key:_.id,class:"text-secondary"},[t("small",null,o(_.label||_.type)+" - "+o(_.address_line)+" "+o(_.city),1)]))),128)),!a.addresses||a.addresses.length===0?(n(),d("div",fs,[...s[9]||(s[9]=[t("small",null,"--",-1)])])):m("",!0)]),t("td",ps,[t("div",bs,[t("button",{onClick:_=>e.openView(a),type:"button",class:"btn btn-sm btn-ghost-secondary"},o(e.__("view")),9,ys),t("button",{onClick:_=>e.openEdit(a),type:"button",class:"btn btn-sm btn-ghost-warning"},o(e.__("edit")),9,Fs),t("button",{onClick:_=>e.confirmDelete(a),type:"button",class:"btn btn-sm btn-ghost-danger"},o(e.__("delete")),9,ks)])])]))),128)),!r.customers.data||r.customers.data.length===0?(n(),d("tr",ws,[t("td",Es,o(e.__("no_customers_found")),1)])):m("",!0)])])]),t("div",xs,[t("p",Cs,[v(o(e.__("showing"))+" ",1),t("span",null,o(r.customers.data.length>0?(r.customers.current_page-1)*r.customers.per_page+1:0),1),v(" "+o(e.__("to"))+" ",1),t("span",null,o(r.customers.data.length>0?(r.customers.current_page-1)*r.customers.per_page+r.customers.data.length:0),1),v(" "+o(e.__("of"))+" ",1),t("span",null,o(r.customers.total||0),1),v(" "+o(e.__("entries")),1)]),t("ul",Ts,[t("li",{class:u(["page-item",{disabled:!r.customers.prev_page_url}])},[t("a",{class:"page-link",href:"#",onClick:s[4]||(s[4]=x((...a)=>e.prevPage&&e.prevPage(...a),["prevent"])),tabindex:r.customers.prev_page_url?null:"-1","aria-disabled":!r.customers.prev_page_url},[s[10]||(s[10]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),t("path",{d:"M15 6l-6 6l6 6"})],-1)),v(" "+o(e.__("prev")),1)],8,Ms)],2),(n(!0),d(b,null,y(e.getPageNumbers(),a=>(n(),d("li",{class:u(["page-item",{active:r.customers.current_page===a}]),key:a},[t("a",{class:"page-link",href:"#",onClick:x(h=>e.fetchCustomers(a),["prevent"])},o(a),9,As)],2))),128)),t("li",{class:u(["page-item",{disabled:!r.customers.next_page_url}])},[t("a",{class:"page-link",href:"#",onClick:s[5]||(s[5]=x((...a)=>e.nextPage&&e.nextPage(...a),["prevent"])),tabindex:r.customers.next_page_url?null:"-1","aria-disabled":!r.customers.next_page_url},[v(o(e.__("next"))+" ",1),s[11]||(s[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),t("path",{d:"M9 6l6 6l-6 6"})],-1))],8,Ss)],2)])]),A(f,{show:r.showModal,mode:r.modalMode,customer:r.selectedCustomer,errors:r.validationErrors,onClose:e.handleModalClose,onSave:e.handleModalSave},null,8,["show","mode","customer","errors","onClose","onSave"])])}const Us=S(Kt,[["render",Is],["__scopeId","data-v-4f6ea456"]]),Vs=U(Us);Vs.mount("#customers-app");
