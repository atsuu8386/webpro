import{r as k,a as i,o as c,b as t,t as d,d as w,w as m,e as _,v as p,n as M,f as x,g,h as F,F as f,i as b,j as v,c as B}from"./vue-kMPmmKrw.js";import"./bootstrap-D5_hyIF7.js";import{_ as T,L as S}from"./LoadingSpinner-CfOyOWer.js";import"./vendor-B9ygI19o.js";const E={name:"TagModal",components:{LoadingSpinner:S},props:{show:{type:Boolean,default:!1},mode:{type:String,default:"add"},tag:{type:Object,default:null}},data(){return{localForm:{name:"",color:"#3b82f6"},isLoading:!1,t:window.tagTranslations||{}}},watch:{show(s){s?this.$nextTick(()=>{this.$refs.triggerButton&&this.$refs.triggerButton.click()}):this.$nextTick(()=>{const e=document.getElementById("tagModal");if(e){const r=e.querySelector('button[data-bs-dismiss="modal"]');r&&r.click()}})},tag(s){this.mode==="edit"&&s&&s.id?(this.isLoading=!0,axios.get(`/tags/${s.id}`).then(e=>{this.populateForm(e.data)}).catch(e=>{console.error("Error fetching tag:",e),this.$emit("close"),alert(this.__("error_fetching_data")||"Error loading tag data")}).finally(()=>{this.isLoading=!1})):s&&this.populateForm(s)},mode(s){s==="add"&&this.resetForm()}},mounted(){const s=document.getElementById("tagModal");s&&s.addEventListener("hidden.bs.modal",()=>{this.$emit("close")})},methods:{__(s,e=""){const r=s.split(".");let a=this.t;for(const l of r)if(a=a==null?void 0:a[l],a===void 0)break;return a!==void 0?a:e||s},populateForm(s){this.localForm={name:s.name||"",color:s.color||"#3b82f6"}},getContrastColor(s){const e=parseInt(s.slice(1,3),16),r=parseInt(s.slice(3,5),16),a=parseInt(s.slice(5,7),16);return(.299*e+.587*r+.114*a)/255>.5?"#000000":"#ffffff"},resetForm(){this.localForm={name:"",color:"#3b82f6"}},handleSave(){!this.localForm.name||!this.localForm.color||(this.localForm.color.startsWith("#")||(this.localForm.color="#"+this.localForm.color),this.$emit("save",{...this.localForm}))}}},L={ref:"triggerButton",type:"button",class:"d-none","data-bs-toggle":"modal","data-bs-target":"#tagModal"},P={class:"modal fade",id:"tagModal",tabindex:"-1","aria-labelledby":"tagModalLabel","aria-hidden":"true"},I={class:"modal-dialog"},V={class:"modal-content"},N={class:"modal-header"},j={class:"modal-title",id:"tagModalLabel"},A={class:"modal-body position-relative"},U={class:"mb-3"},q={class:"form-label"},z=["disabled"],D={class:"mb-3"},O={class:"form-label"},H={class:"input-group"},W=["disabled"],G=["disabled"],J={class:"mt-2"},K={class:"modal-footer"},Q={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function R(s,e,r,a,l,o){const h=k("LoadingSpinner");return c(),i("div",null,[t("button",L,null,512),t("div",P,[t("div",I,[t("div",V,[t("div",N,[t("h5",j,d(s.modalMode==="add"?o.__("add_tag"):o.__("edit_tag")),1),e[5]||(e[5]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",A,[w(h,{visible:l.isLoading},null,8,["visible"]),t("form",{onSubmit:e[3]||(e[3]=m((...n)=>o.handleSave&&o.handleSave(...n),["prevent"]))},[t("div",U,[t("label",q,d(o.__("name")),1),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>l.localForm.name=n),type:"text",class:"form-control",disabled:s.modalMode==="view",required:""},null,8,z),[[p,l.localForm.name]])]),t("div",D,[t("label",O,d(o.__("color")),1),t("div",H,[_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.localForm.color=n),type:"color",class:"form-control form-control-color",disabled:s.modalMode==="view",required:""},null,8,W),[[p,l.localForm.color]]),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.localForm.color=n),type:"text",class:"form-control",pattern:"^#[0-9A-Fa-f]{6}$",disabled:s.modalMode==="view",placeholder:"#3b82f6"},null,8,G),[[p,l.localForm.color]])]),t("div",J,[t("span",{class:"badge",style:M({backgroundColor:l.localForm.color,color:o.getContrastColor(l.localForm.color)})},d(o.__("preview")),5)])])],32)]),t("div",K,[t("button",Q,d(o.__("close")),1),s.modalMode!=="view"?(c(),i("button",{key:0,type:"button",class:"btn btn-primary",onClick:e[4]||(e[4]=(...n)=>o.handleSave&&o.handleSave(...n))},d(o.__("save")),1)):x("",!0)])])])])])}const X=T(E,[["render",R]]),u=window.axios,Y={name:"TagList",components:{TagModal:X},data(){return{tags:{data:[],current_page:1,per_page:10,total:0,prev_page_url:null,next_page_url:null},search:"",perPage:50,perPageOptions:[10,20,50,100],showModal:!1,modalMode:"add",selectedTag:null,t:window.tagTranslations||{}}},mounted(){this.fetchTags();const s=document.getElementById("btn-add-tag"),e=document.getElementById("btn-add-tag-mobile");s&&s.addEventListener("click",()=>this.openAdd()),e&&e.addEventListener("click",()=>this.openAdd())},methods:{__(s,e=""){const r=s.split(".");let a=this.t;for(const l of r)if(a=a==null?void 0:a[l],a===void 0)break;return a!==void 0?a:e||s},getContrastColor(s){const e=parseInt(s.slice(1,3),16),r=parseInt(s.slice(3,5),16),a=parseInt(s.slice(5,7),16);return(.299*e+.587*r+.114*a)/255>.5?"#000000":"#ffffff"},async fetchTags(s=1){try{const e={page:s,per_page:this.perPage};this.search&&(e.search=this.search);const r=await u.get("/tags",{params:e});this.tags=r.data}catch(e){console.error("Error fetching tags:",e),alert(this.__("fetch_error"))}},getPageNumbers(){const s=this.tags.current_page,e=this.tags.last_page||1,r=[];if(e<=7)for(let a=1;a<=e;a++)r.push(a);else if(s<=3){for(let a=1;a<=5;a++)r.push(a);r.push("..."),r.push(e)}else if(s>=e-2){r.push(1),r.push("...");for(let a=e-4;a<=e;a++)r.push(a)}else{r.push(1),r.push("...");for(let a=s-1;a<=s+1;a++)r.push(a);r.push("..."),r.push(e)}return r},prevPage(){this.tags.prev_page_url&&this.fetchTags(this.tags.current_page-1)},nextPage(){this.tags.next_page_url&&this.fetchTags(this.tags.current_page+1)},openAdd(){this.modalMode="add",this.selectedTag=null,this.showModal=!0},openEdit(s){this.modalMode="edit",this.selectedTag={...s},this.showModal=!0},handleModalClose(){this.showModal=!1,this.selectedTag=null},async handleModalSave(s){var e,r,a,l;try{this.modalMode==="add"?await u.post("/tags",s):await u.put(`/tags/${this.selectedTag.id}`,s),this.closeModal(),this.fetchTags(this.tags.current_page)}catch(o){const h=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||((l=(a=o.response)==null?void 0:a.data)==null?void 0:l.error)||o.message;alert(h||this.__("save_error"))}},closeModal(){this.$nextTick(()=>{const s=document.getElementById("tagModal");if(s){const e=s.querySelector('button[data-bs-dismiss="modal"]');e?e.click():(this.showModal=!1,this.selectedTag=null)}else this.showModal=!1,this.selectedTag=null})},async confirmDelete(s){var e,r,a,l;if(confirm(this.__("delete_confirm",`Bạn có chắc chắn muốn xóa tag "${s.name}"?`)))try{await u.delete(`/tags/${s.id}`),this.fetchTags(this.tags.current_page)}catch(o){const h=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||((l=(a=o.response)==null?void 0:a.data)==null?void 0:l.error)||o.message;alert(h||this.__("delete_error"))}}}},Z={class:"card-body border-bottom py-3"},$={class:"d-flex"},ee={class:"text-secondary"},te={class:"mx-2 d-inline-block"},se=["value"],oe={class:"ms-auto text-secondary"},le={class:"ms-2 d-inline-block"},ae=["placeholder"],ne={class:"table-responsive"},re={class:"table card-table table-vcenter text-nowrap datatable"},de={class:"w-1"},ie={class:"text-secondary"},ce={href:"#",class:"text-reset"},ge={class:"text-end"},he={class:"btn-list justify-content-end"},_e=["onClick"],ue=["onClick"],me={key:0},pe={colspan:"4",class:"text-center text-secondary py-4"},fe={class:"card-footer d-flex align-items-center"},be={class:"m-0 text-secondary"},ve={class:"pagination m-0 ms-auto"},ye=["tabindex","aria-disabled"],ke=["onClick"],we=["tabindex","aria-disabled"];function Me(s,e,r,a,l,o){const h=k("TagModal");return c(),i("div",null,[t("div",Z,[t("div",$,[t("div",ee,[g(d(o.__("show"))+" ",1),t("div",te,[_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>l.perPage=n),onChange:e[1]||(e[1]=(...n)=>o.fetchTags&&o.fetchTags(...n)),class:"form-select form-select-sm"},[(c(!0),i(f,null,b(l.perPageOptions,n=>(c(),i("option",{key:n,value:n},d(n),9,se))),128))],544),[[F,l.perPage,void 0,{number:!0}]])]),g(" "+d(o.__("entries")),1)]),t("div",oe,[g(d(o.__("search"))+": ",1),t("div",le,[_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.search=n),onInput:e[3]||(e[3]=(...n)=>o.fetchTags&&o.fetchTags(...n)),type:"text",class:"form-control form-control-sm",placeholder:o.__("search_placeholder")},null,40,ae),[[p,l.search]])])])])]),t("div",ne,[t("table",re,[t("thead",null,[t("tr",null,[t("th",de,d(o.__("no")),1),t("th",null,d(o.__("name")),1),t("th",null,d(o.__("color")),1),e[6]||(e[6]=t("th",null,null,-1))])]),t("tbody",null,[(c(!0),i(f,null,b(l.tags.data,(n,y)=>(c(),i("tr",{key:n.id},[t("td",null,[t("span",ie,d((l.tags.current_page-1)*l.tags.per_page+y+1),1)]),t("td",null,[t("a",ce,d(n.name),1)]),t("td",null,[t("span",{class:"badge",style:M({backgroundColor:n.color,color:o.getContrastColor(n.color)})},d(n.name),5)]),t("td",ge,[t("div",he,[t("button",{onClick:C=>o.openEdit(n),type:"button",class:"btn btn-sm btn-ghost-warning"},d(o.__("edit")),9,_e),t("button",{onClick:C=>o.confirmDelete(n),type:"button",class:"btn btn-sm btn-ghost-danger"},d(o.__("delete")),9,ue)])])]))),128)),!l.tags.data||l.tags.data.length===0?(c(),i("tr",me,[t("td",pe,d(o.__("no_tags_found")),1)])):x("",!0)])])]),t("div",fe,[t("p",be,[g(d(o.__("showing"))+" ",1),t("span",null,d(l.tags.data.length>0?(l.tags.current_page-1)*l.tags.per_page+1:0),1),g(" "+d(o.__("to"))+" ",1),t("span",null,d(l.tags.data.length>0?(l.tags.current_page-1)*l.tags.per_page+l.tags.data.length:0),1),g(" "+d(o.__("of"))+" ",1),t("span",null,d(l.tags.total||0),1),g(" "+d(o.__("entries")),1)]),t("ul",ve,[t("li",{class:v(["page-item",{disabled:!l.tags.prev_page_url}])},[t("a",{class:"page-link",href:"#",onClick:e[4]||(e[4]=m((...n)=>o.prevPage&&o.prevPage(...n),["prevent"])),tabindex:l.tags.prev_page_url?null:"-1","aria-disabled":!l.tags.prev_page_url},[e[7]||(e[7]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),t("path",{d:"M15 6l-6 6l6 6"})],-1)),g(" "+d(o.__("prev")),1)],8,ye)],2),(c(!0),i(f,null,b(o.getPageNumbers(),n=>(c(),i("li",{class:v(["page-item",{active:l.tags.current_page===n}]),key:n},[t("a",{class:"page-link",href:"#",onClick:m(y=>o.fetchTags(n),["prevent"])},d(n),9,ke)],2))),128)),t("li",{class:v(["page-item",{disabled:!l.tags.next_page_url}])},[t("a",{class:"page-link",href:"#",onClick:e[5]||(e[5]=m((...n)=>o.nextPage&&o.nextPage(...n),["prevent"])),tabindex:l.tags.next_page_url?null:"-1","aria-disabled":!l.tags.next_page_url},[g(d(o.__("next"))+" ",1),e[8]||(e[8]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),t("path",{d:"M9 6l6 6l-6 6"})],-1))],8,we)],2)])]),w(h,{show:l.showModal,mode:l.modalMode,tag:l.selectedTag,onClose:o.handleModalClose,onSave:o.handleModalSave},null,8,["show","mode","tag","onClose","onSave"])])}const xe=T(Y,[["render",Me]]),Te=B(xe);Te.mount("#tags-app");
